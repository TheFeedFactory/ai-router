{
  "timeout": "1200s",
  "steps": [
    {
      "name": "gcr.io/kaniko-project/executor:latest",
      "args": [
        "--cache=true",
        "--destination=gcr.io/${_PROJECT}/${_CONTAINERNAME}:${SHORT_SHA}"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": ["push", "gcr.io/${_PROJECT}/${_CONTAINERNAME}:${SHORT_SHA}"]
    },
    {
      "name": "gcr.io/cloud-builders/kubectl",
      "args": [
        "set",
        "image",
        "deployment/${_DEPLOYMENTNAME}",
        "${_CONTAINERNAME}=gcr.io/${_PROJECT}/${_CONTAINERNAME}:${SHORT_SHA}"
      ],
      "env": [
        "CLOUDSDK_COMPUTE_ZONE=${_ZONE}",
        "CLOUDSDK_CONTAINER_CLUSTER=${_GKE_CLUSTER}"
      ]
    }
  ],
  "substitutions": {
    "_PROJECT": "the-feedfactory",
    "_ZONE": "europe-west4-a",
    "_GKE_CLUSTER": "ff-main-nat-cluster",
    "_DEPLOYMENTNAME": "staging-ai-router",
    "_CONTAINERNAME": "ai-router"
  }
}
